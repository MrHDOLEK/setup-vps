version: '3'
services:
  n8n:
    image: docker.n8n.io/n8nio/n8n
    env_file:
      - ./.env
    ports:
      - '127.0.0.1:5678:5678'
    user: "1000"
    labels:
      - traefik.enable=true
      - traefik.http.routers.n8n.rule=Host(`${DOMAIN_NAME}`)
      - traefik.http.routers.n8n.entrypoints=https
      - traefik.http.routers.n8n.tls=true
      - traefik.http.routers.n8n.tls.certresolver=letsencrypt
      - traefik.http.services.n8n.loadbalancer.server.port=5678
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./.n8n:/home/node/.n8n
    networks:
      - n8n-network
      - traefik

# Networks
networks:
  n8n-network:
    driver: bridge
  traefik:
    external:
      name: traefik